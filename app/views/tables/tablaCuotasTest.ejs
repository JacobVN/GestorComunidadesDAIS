<div class="container">
  <div class="table-wrapper">
    <h4 class="bg-grey">Cuotas <%= year %>:</h4>
    <% var deudaAc = 0 %>
    <div class="form-row">
      <div class="form-group col-md-2">
        <label for="search">Filtrar:</label>
        <input type="text" class="form-control" onkeyup="filtra('tablaCuotas','search')" name="search" id="search" value="">
      </div>
    </div>
    <table class="table table-hovered" id="tablaCuotas">
      <thead class="thead-dark">
        <tr class="header">
          <th scope="col">ID</th>
          <th scope="col">Fecha</th>
          <th scope="col">Mes</th>
          <th scope="col">Importe</th>
          <th scope="col">Pagado</th>
          <th scope="col">
            <a href="/viviendas/<%= vivienda.id_vivienda %>/cuotas/0" class="btn btn-sm btn-success hidden-print">Añadir</a>
          </th>
        </tr>
      </thead>
      <% if (cuotas.length > 0) {%>
      <tbody>
        <% Array.prototype.forEach.call(cuotas, cuota => { %>
        <tr>
          <th scope="row"><%= cuota.id_cuota %></th>
          <td><%= cuota.fecha %></td>
          <td><%= (new Date(cuota.fecha)).toLocaleString('en-GB', { month: 'long' }) %></td>
          <td><%= cuota.importe %> €</td>
          <td>
            <% if (cuota.pagado){ %>
            <span class="glyphicon glyphicon-ok text-primary"></span>
            <% } else { %>
              <% deudaAc += cuota.importe %>
            <span class="glyphicon glyphicon-remove text-danger"></span>
            <% } %>
          </td>
          <td>
            <a href="/viviendas/<%= vivienda.id_vivienda %>/cuotas/<%= cuota.id_cuota %>" rel="noopener" class="btn btn-sm btn-info hidden-print">Ver</a>
          </td>
        </tr>
        <% }) %>
      </tbody>
      <tfoot>
        <tr>
          <th colspan="2">Deuda pendiente: <%= deudaAc %> €</th>
          <th colspan="2">Deuda anterior: <%= deuda %> €</th>
          <th colspan="2">Deuda total: <%= deudaAc + deuda %> €</th>
        </tr>
      </tfoot>
      <% } else { %>
      <tr>
        <td colspan="10">
          <p class="text-center">No hay cuotas asignadas a esta vivienda.</p>
        </td>
      </tr>
      <tfoot></tfoot>
      <% } %>
    </table>
  </div>
  <script type="text/javascript">
    function filtra() {
      // Declare variables
      var input, filter, table, tr, td, i, txtValue;
      input = document.getElementById("search");
      filter = input.value.toUpperCase();
      table = document.getElementById("tablaCuotas");
      tr = table.getElementsByTagName("tr");

      // Loop through all table rows, and hide those who don't match the search query
      for (i = 0; i < tr.length; i++) {
        td = tr[i].getElementsByTagName("td")[0];
        td1 = tr[i].getElementsByTagName("td")[1];
        if (td || td1) {
          txtValue = td.textContent || td.innerText;
          txtValue2 = td1.textContent || td1.innerText;
          if (txtValue.toUpperCase().indexOf(filter) > -1 || txtValue2.toUpperCase().indexOf(filter) > -1) {
            tr[i].style.display = "";
          } else {
            tr[i].style.display = "none";
          }
        }
      }
    }
  </script>
</div>
